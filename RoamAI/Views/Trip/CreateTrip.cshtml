@model TravelRequestModel

<div>
    <h2>Travel Planı Oluştur</h2>
    <form method="post" asp-action="GetRecommendations" asp-controller="Trip">
        <label>Ülke: </label>
        <select id="country" name="Country" class="choices" required>
            <option value="">Select Country</option>
        </select>
        <br />

        <label>Şehir: </label>
        <select id="city" name="City" required>
            <option value="">Select City</option>
        </select>
        <br />

        <label>Gideceğiniz Tarih: </label>
        <input type="date" name="TravelDate" required />
        <br />

        <label>Kültürel Gezi Yüzdesi: </label>
        <input type="number" name="CulturalPercentage" required min="0" max="100" value="40" />
        <br />

        <label>Modern Gezi Yüzdesi: </label>
        <input type="number" name="ModernPercentage" required min="0" max="100" value="30" />
        <br />

        <label>Yemek Üzerine Gezi Yüzdesi: </label>
        <input type="number" name="FoodPercentage" required min="0" max="100" value="30" />
        <br />

        <button type="submit" id="submitBtn">Plan Oluştur</button>
    </form>

    @if (Model != null && Model.Recommendations != null && Model.Recommendations.Any())
    {
        <h3>Gezilecek Yerler</h3>
        <ul>
            @foreach (var recommendation in Model.Recommendations)
            {
                <li>@recommendation</li>
            }
        </ul>

        <h3>@Model.City hakkında Bilgiler</h3>
        <p>@Model.CityInformation</p> <!-- Şehir hakkında bilgiyi burada gösteriyoruz. -->

    }
</div>

<!-- Choices.js CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Choices.js JS -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<!-- Custom Script -->
<script>
    $(document).ready(function () {
        // Choices.js ülke select kutusuna uygula
        const countrySelect = new Choices('#country', {
            searchEnabled: true,
            placeholderValue: 'Ülke Seçiniz',
            searchPlaceholderValue: 'Aramak için yazın...'
        });

        var citiesData = [];
        $.getJSON('/data/countries.json', function (data) {
            // Ülkeler için seçenekler ekle
            countrySelect.setChoices(data.map(country => ({
                value: country.countryId,
                label: country.name
            })), 'value', 'label', true);
        }).fail(function () {
            console.error('Failed to load countries.json');
        });

        $.getJSON('/data/cities.json', function (data) {
            citiesData = data; // Şehir verilerini depola
        }).fail(function () {
            console.error('Failed to load cities.json');
        });

        $('#country').change(function () {
            var selectedCountryId = $(this).val();
            var $citySelect = $('#city');
            $citySelect.empty(); // Önceki şehirleri temizle
            $citySelect.append($('<option>', { value: '', text: 'Select City' }));

            if (selectedCountryId) {
                var filteredCities = citiesData.filter(function (city) {
                    return city.countryId === selectedCountryId;
                });

                // Şehirleri select kutusuna ekle
                $.each(filteredCities, function (index, city) {
                    $citySelect.append($('<option>', {
                        value: city.id,
                        text: city.name
                    }));
                });
            }
        });

        // Yüzde kontrolü: Toplam %100 olmalı
        $('#submitBtn').click(function (e) {
            var cultural = parseInt($('input[name="CulturalPercentage"]').val(), 10) || 0;
            var modern = parseInt($('input[name="ModernPercentage"]').val(), 10) || 0;
            var food = parseInt($('input[name="FoodPercentage"]').val(), 10) || 0;
            var total = cultural + modern + food;

            if (total !== 100) {
                e.preventDefault(); // Formun gönderilmesini engelle
                alert('Gezi türü yüzdelerinin toplamı 100 olmalıdır!');
            }
        });
    });
</script>
